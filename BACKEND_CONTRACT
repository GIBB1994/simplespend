Backend Contract (Current, Canonical)
Tables
budgets

id (uuid)

name

created_at

budget_members

budget_id

user_id

role (owner/editor/viewer)

months

(budget_id, month_key) PK

income_cents

Auto-creates Extra category

monthly_categories

(budget_id, month_key, category_key) PK

budgeted_cents

is_extra enforced by constraint

monthly_expenses

amount_cents <> 0

FK â†’ monthly_categories

Extra cannot be manually selected

annual_items

id (uuid)

budget_id

type âˆˆ {annual_budget, sinking_fund}

year (required for annual_budget, NULL for sinking_fund)

item_key NOT NULL, stable

name

target_cents

initial_cents

annual_ledger

id

budget_id

annual_item_id

entry_type âˆˆ {expense, contribution}

amount_cents <> 0

entry_date

vendor (nullable)

item (nullable)

note

Important change:
Vendor/item are NOT structurally enforced.
They are UI concerns, not DB constraints.

Backend Guarantees

All data scoped by budget_id

RLS enforced everywhere

RPC required for budget creation

Cascades are intentional and predictable

No hidden side effects

Service Worker Rules (Locked)

Cache assets only

Network-first for:

HTML

JS

Cache-first for:

CSS

Icons

Supabase traffic is never cached

Known Current Limitations (Accepted)

Annual UI can be cleaner (grouping, filters)

New user onboarding still fragile

No invite flow yet

No reporting views

Offline writes not supported (read-only offline)

All intentional for this stage.

ðŸ§± Backend Contract Summary (Drop-In Version)

Annual budgets are year-scoped rows in annual_items.
Sinking funds are all-time rows.
Ledger entries move money.
Targets are notes.
Balances are computed.
Rollover is explicit and one-time.
